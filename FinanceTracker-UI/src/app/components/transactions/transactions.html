<div class="container mt-4 pb-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold text-dark">
      <i class="bi bi-list-check me-2 text-primary"></i>Transactions History
    </h3>
    <button
      class="btn btn-primary px-4 shadow-sm rounded-pill"
      data-bs-toggle="modal"
      data-bs-target="#addModal"
      (click)="openAddModal()"
    >
      <i class="bi bi-plus-lg me-2"></i> Add New
    </button>
  </div>

  <div class="card shadow-sm border-0 rounded-3 overflow-hidden">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th class="ps-4">Date</th>
            <th>Category</th>
            <th>Description</th>
            <th>Amount</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of transactions">
            <td class="ps-4 fw-medium text-secondary">{{ item.date | date: 'mediumDate' }}</td>
            <td>
              <span class="badge bg-light text-dark border px-3 py-2 rounded-pill shadow-xs">
                <span class="me-1">{{ item.categoryIcon }}</span> {{ item.categoryName }}
              </span>
            </td>
            <td class="text-muted small">{{ item.description || '---' }}</td>
            <td>
              <span [ngClass]="item.type == 1 ? 'text-success' : 'text-danger'" class="fw-bold">
                {{ item.type == 1 ? '+' : '-' }} {{ item.amount | currency: 'EGP ' }}
              </span>
            </td>
            <td class="text-center pe-3">
              <button
                class="btn btn-sm btn-outline-info border-0 me-1"
                data-bs-toggle="modal"
                data-bs-target="#addModal"
                (click)="openEditModal(item)"
                title="Edit"
              >
                <i class="bi bi-pencil-square fs-5"></i>
              </button>
              <button
                class="btn btn-sm btn-outline-danger border-0"
                (click)="deleteItem(item.id)"
                title="Delete"
              >
                <i class="bi bi-trash3 fs-5"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="transactions.length === 0">
            <td colspan="5" class="text-center py-5">
              <img
                src="https://cdn-icons-png.flaticon.com/512/4076/4076549.png"
                width="80"
                class="opacity-25 mb-3 d-block mx-auto"
              />
              <p class="text-muted mb-0">No transactions found. Start by adding one!</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="modal fade" id="addModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg rounded-4">
        <div
          class="modal-header border-0 pb-0"
          [ngClass]="newTransaction.type == 1 ? 'text-success' : 'text-danger'"
        >
          <h5 class="modal-title fw-bold">
            <i class="bi" [ngClass]="isEditMode ? 'bi-pencil-square' : 'bi-plus-circle'"></i>
            {{ isEditMode ? ' Edit Transaction' : ' New Transaction' }}
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <form (ngSubmit)="onSave()">
          <div class="modal-body p-4">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label small fw-bold text-muted">Amount (EGP)</label>
                <div class="input-group">
                  <span class="input-group-text bg-white border-end-0 text-muted"
                    ><i class="bi bi-cash-coin"></i
                  ></span>
                  <input
                    type="number"
                    name="amount"
                    [(ngModel)]="newTransaction.amount"
                    class="form-control border-start-0 ps-0"
                    required
                    placeholder="0.00"
                  />
                </div>
              </div>
              <div class="col-md-6">
                <label class="form-label small fw-bold text-muted">Transaction Type</label>
                <select
                  name="type"
                  [(ngModel)]="newTransaction.type"
                  (ngModelChange)="newTransaction.type = +$event"
                  class="form-select shadow-none"
                >
                  <option [ngValue]="1">Income (+)</option>
                  <option [ngValue]="2">Expense (-)</option>
                </select>
              </div>
              <div class="col-12">
                <label class="form-label small fw-bold text-muted">Category</label>
                <select
                  name="categoryId"
                  [(ngModel)]="newTransaction.categoryId"
                  class="form-select shadow-none"
                  required
                >
                  <option value="">Select Category</option>
                  <option *ngFor="let cat of categories" [value]="cat.id">
                    {{ cat.icon }} {{ cat.name }}
                  </option>
                </select>
              </div>
              <div class="col-12">
                <label class="form-label small fw-bold text-muted">Date</label>
                <input
                  type="date"
                  name="date"
                  [(ngModel)]="newTransaction.date"
                  class="form-control shadow-none"
                  required
                />
              </div>
              <div class="col-12">
                <label class="form-label small fw-bold text-muted">Description</label>
                <textarea
                  name="desc"
                  [(ngModel)]="newTransaction.description"
                  class="form-control shadow-none"
                  rows="2"
                  placeholder="Note (optional)..."
                ></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer border-0 pt-0">
            <button type="button" class="btn btn-light text-muted px-4" data-bs-dismiss="modal">
              Cancel
            </button>
            <button
              type="submit"
              class="btn px-5 rounded-pill shadow-sm fw-bold"
              [ngClass]="isEditMode ? 'btn-info text-white' : 'btn-primary'"
              [disabled]="
                (isEditMode && !checkIfChanged()) ||
                !newTransaction.amount ||
                !newTransaction.categoryId
              "
            >
              {{ isEditMode ? 'Update Changes' : 'Save Transaction' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
